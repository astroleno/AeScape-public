<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AeScape ä¼˜åŒ–åŠŸèƒ½æµ‹è¯•</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      min-height: 100vh;
    }
    
    .test-container {
      max-width: 800px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.1);
      padding: 30px;
      border-radius: 20px;
      backdrop-filter: blur(10px);
    }
    
    .test-section {
      margin: 30px 0;
      padding: 20px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
    }
    
    .test-button {
      background: rgba(255, 255, 255, 0.2);
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      color: white;
      cursor: pointer;
      margin: 5px;
      transition: all 0.3s ease;
    }
    
    .test-button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
    }
    
    .test-result {
      margin: 10px 0;
      padding: 10px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 8px;
      font-family: monospace;
      font-size: 14px;
    }
    
    .success { border-left: 4px solid #4CAF50; }
    .error { border-left: 4px solid #f44336; }
    .warning { border-left: 4px solid #ff9800; }
    .info { border-left: 4px solid #2196F3; }
  </style>
</head>
<body>
  <div class="test-container">
    <h1>ğŸš€ AeScape ä¼˜åŒ–åŠŸèƒ½æµ‹è¯•</h1>
    <p>æ­¤é¡µé¢ç”¨äºæµ‹è¯•æ–°å¢çš„ä¼˜åŒ–æ¨¡å—æ˜¯å¦æ­£å¸¸å·¥ä½œ</p>
    
    <!-- é”™è¯¯å¤„ç†å™¨æµ‹è¯• -->
    <div class="test-section">
      <h2>ğŸ›¡ï¸ é”™è¯¯å¤„ç†å™¨æµ‹è¯•</h2>
      <button class="test-button" onclick="testErrorHandler()">æµ‹è¯•é”™è¯¯å¤„ç†</button>
      <button class="test-button" onclick="testCriticalError()">æµ‹è¯•å…³é”®é”™è¯¯</button>
      <div id="error-handler-result" class="test-result"></div>
    </div>
    
    <!-- æ€§èƒ½ç›‘æ§å™¨æµ‹è¯• -->
    <div class="test-section">
      <h2>ğŸ“Š æ€§èƒ½ç›‘æ§å™¨æµ‹è¯•</h2>
      <button class="test-button" onclick="testPerformanceMonitor()">æµ‹è¯•æ€§èƒ½ç›‘æ§</button>
      <button class="test-button" onclick="showPerformanceStats()">æ˜¾ç¤ºæ€§èƒ½ç»Ÿè®¡</button>
      <div id="performance-result" class="test-result"></div>
    </div>
    
    <!-- é…ç½®ç®¡ç†å™¨æµ‹è¯• -->
    <div class="test-section">
      <h2>âš™ï¸ é…ç½®ç®¡ç†å™¨æµ‹è¯•</h2>
      <button class="test-button" onclick="testConfigManager()">æµ‹è¯•é…ç½®ç®¡ç†</button>
      <button class="test-button" onclick="testConfigValidation()">æµ‹è¯•é…ç½®éªŒè¯</button>
      <div id="config-result" class="test-result"></div>
    </div>
    
    <!-- è§†é¢‘èµ„æºç®¡ç†å™¨æµ‹è¯• -->
    <div class="test-section">
      <h2>ğŸ¬ è§†é¢‘èµ„æºç®¡ç†å™¨æµ‹è¯•</h2>
      <button class="test-button" onclick="testVideoResourceManager()">æµ‹è¯•è§†é¢‘ç¼“å­˜</button>
      <button class="test-button" onclick="showVideoStats()">æ˜¾ç¤ºç¼“å­˜ç»Ÿè®¡</button>
      <div id="video-resource-result" class="test-result"></div>
    </div>
    
    <!-- æ™ºèƒ½ä¸»é¢˜é€‚é…å™¨æµ‹è¯• -->
    <div class="test-section">
      <h2>ğŸ¨ æ™ºèƒ½ä¸»é¢˜é€‚é…å™¨æµ‹è¯•</h2>
      <button class="test-button" onclick="testThemeAdapter()">æµ‹è¯•ä¸»é¢˜ç¼“å­˜</button>
      <button class="test-button" onclick="testThemeTransition()">æµ‹è¯•ä¸»é¢˜åˆ‡æ¢</button>
      <div id="theme-adapter-result" class="test-result"></div>
    </div>
    
    <!-- æ•´ä½“é›†æˆæµ‹è¯• -->
    <div class="test-section">
      <h2>ğŸ”„ æ•´ä½“é›†æˆæµ‹è¯•</h2>
      <button class="test-button" onclick="runFullTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
      <div id="integration-result" class="test-result"></div>
    </div>
  </div>

  <!-- åŠ è½½ä¼˜åŒ–æ¨¡å— -->
  <script src="js/ErrorHandler.js"></script>
  <script src="js/PerformanceMonitor.js"></script>
  <script src="js/ConfigManager.js"></script>
  <script src="js/VideoResourceManager.js"></script>
  <script src="js/SmartThemeAdapter.js"></script>

  <script>
    // å…¨å±€æµ‹è¯•å®ä¾‹
    let errorHandler, performanceMonitor, configManager, videoResourceManager, smartThemeAdapter;
    
    // åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ
    async function initTestEnvironment() {
      try {
        errorHandler = new AeScapeErrorHandler();
        performanceMonitor = new AeScapePerformanceMonitor();
        configManager = new AeScapeConfigManager();
        videoResourceManager = new VideoResourceManager();
        smartThemeAdapter = new SmartThemeAdapter({ debugMode: true });
        
        console.log('æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å®Œæˆ');
      } catch (error) {
        console.error('æµ‹è¯•ç¯å¢ƒåˆå§‹åŒ–å¤±è´¥:', error);
      }
    }
    
    // é”™è¯¯å¤„ç†å™¨æµ‹è¯•
    function testErrorHandler() {
      const resultDiv = document.getElementById('error-handler-result');
      try {
        // æµ‹è¯•æ™®é€šé”™è¯¯å¤„ç†
        const testError = new Error('è¿™æ˜¯ä¸€ä¸ªæµ‹è¯•é”™è¯¯');
        const errorInfo = errorHandler.handleError(testError, 'TestContext', { severity: 'warning' });
        
        resultDiv.innerHTML = `
          <div class="success">âœ… é”™è¯¯å¤„ç†å™¨æµ‹è¯•é€šè¿‡</div>
          <div class="info">é”™è¯¯ID: ${errorInfo.timestamp}</div>
          <div class="info">ä¸Šä¸‹æ–‡: ${errorInfo.context}</div>
        `;
        resultDiv.className = 'test-result success';
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">âŒ é”™è¯¯å¤„ç†å™¨æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
        resultDiv.className = 'test-result error';
      }
    }
    
    function testCriticalError() {
      const resultDiv = document.getElementById('error-handler-result');
      try {
        const criticalError = new Error('å…³é”®ç³»ç»Ÿé”™è¯¯');
        errorHandler.handleError(criticalError, 'CriticalSystem', { 
          severity: 'critical',
          showNotification: true 
        });
        
        resultDiv.innerHTML += `<div class="warning">âš ï¸ å…³é”®é”™è¯¯å¤„ç†æµ‹è¯•å®Œæˆ</div>`;
      } catch (error) {
        resultDiv.innerHTML += `<div class="error">âŒ å…³é”®é”™è¯¯æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
      }
    }
    
    // æ€§èƒ½ç›‘æ§å™¨æµ‹è¯•
    function testPerformanceMonitor() {
      const resultDiv = document.getElementById('performance-result');
      try {
        // è®°å½•ä¸€äº›æµ‹è¯•æŒ‡æ ‡
        performanceMonitor.recordLoadTime('TestComponent', Date.now() - 1000, Date.now());
        performanceMonitor.recordApiResponse('TestAPI', 150);
        
        resultDiv.innerHTML = `
          <div class="success">âœ… æ€§èƒ½ç›‘æ§å™¨æµ‹è¯•é€šè¿‡</div>
          <div class="info">å·²è®°å½•æµ‹è¯•æ€§èƒ½æ•°æ®</div>
        `;
        resultDiv.className = 'test-result success';
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">âŒ æ€§èƒ½ç›‘æ§å™¨æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
        resultDiv.className = 'test-result error';
      }
    }
    
    function showPerformanceStats() {
      const resultDiv = document.getElementById('performance-result');
      try {
        const stats = performanceMonitor.getPerformanceReport();
        resultDiv.innerHTML += `
          <div class="info">ğŸ“Š æ€§èƒ½ç»Ÿè®¡æŠ¥å‘Š:</div>
          <pre>${JSON.stringify(stats, null, 2)}</pre>
        `;
      } catch (error) {
        resultDiv.innerHTML += `<div class="error">âŒ è·å–æ€§èƒ½ç»Ÿè®¡å¤±è´¥: ${error.message}</div>`;
      }
    }
    
    // é…ç½®ç®¡ç†å™¨æµ‹è¯•
    async function testConfigManager() {
      const resultDiv = document.getElementById('config-result');
      try {
        // æµ‹è¯•é…ç½®è¯»å†™
        await configManager.setConfig('test.value', 'hello world');
        const value = configManager.getConfig('test.value');
        
        if (value === 'hello world') {
          resultDiv.innerHTML = `
            <div class="success">âœ… é…ç½®ç®¡ç†å™¨æµ‹è¯•é€šè¿‡</div>
            <div class="info">é…ç½®è¯»å†™åŠŸèƒ½æ­£å¸¸</div>
          `;
          resultDiv.className = 'test-result success';
        } else {
          throw new Error('é…ç½®å€¼ä¸åŒ¹é…');
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">âŒ é…ç½®ç®¡ç†å™¨æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
        resultDiv.className = 'test-result error';
      }
    }
    
    async function testConfigValidation() {
      const resultDiv = document.getElementById('config-result');
      try {
        // æµ‹è¯•é…ç½®éªŒè¯
        const isValid = configManager.validateConfig({
          video: { enabled: true, maxCacheSize: 3 },
          theme: { autoUpdate: true }
        });
        
        resultDiv.innerHTML += `
          <div class="info">ğŸ” é…ç½®éªŒè¯ç»“æœ: ${isValid ? 'é€šè¿‡' : 'å¤±è´¥'}</div>
        `;
      } catch (error) {
        resultDiv.innerHTML += `<div class="error">âŒ é…ç½®éªŒè¯æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
      }
    }
    
    // è§†é¢‘èµ„æºç®¡ç†å™¨æµ‹è¯•
    async function testVideoResourceManager() {
      const resultDiv = document.getElementById('video-resource-result');
      try {
        // åˆ›å»ºä¸€ä¸ªæµ‹è¯•è§†é¢‘å…ƒç´ 
        const testVideo = document.createElement('video');
        testVideo.src = 'data:video/mp4;base64,AAAAHGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMQAAAAhmcmVlAAAGF21kYXQBAAAbBmiAhvbBBgAACjQBAAAK';
        
        // æµ‹è¯•ç¼“å­˜åŠŸèƒ½
        videoResourceManager.addToCache('test-video', testVideo, { type: 'test' });
        const cached = videoResourceManager.getCachedVideo('test-video');
        
        if (cached) {
          resultDiv.innerHTML = `
            <div class="success">âœ… è§†é¢‘èµ„æºç®¡ç†å™¨æµ‹è¯•é€šè¿‡</div>
            <div class="info">è§†é¢‘ç¼“å­˜åŠŸèƒ½æ­£å¸¸</div>
          `;
          resultDiv.className = 'test-result success';
        } else {
          throw new Error('è§†é¢‘ç¼“å­˜å¤±è´¥');
        }
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">âŒ è§†é¢‘èµ„æºç®¡ç†å™¨æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
        resultDiv.className = 'test-result error';
      }
    }
    
    function showVideoStats() {
      const resultDiv = document.getElementById('video-resource-result');
      try {
        const stats = videoResourceManager.getPerformanceMetrics();
        resultDiv.innerHTML += `
          <div class="info">ğŸ“¹ è§†é¢‘ç¼“å­˜ç»Ÿè®¡:</div>
          <pre>${JSON.stringify(stats, null, 2)}</pre>
        `;
      } catch (error) {
        resultDiv.innerHTML += `<div class="error">âŒ è·å–è§†é¢‘ç»Ÿè®¡å¤±è´¥: ${error.message}</div>`;
      }
    }
    
    // æ™ºèƒ½ä¸»é¢˜é€‚é…å™¨æµ‹è¯•
    async function testThemeAdapter() {
      const resultDiv = document.getElementById('theme-adapter-result');
      try {
        const testTheme = {
          primaryColor: '#667eea',
          backgroundColor: '#764ba2',
          textColor: '#ffffff',
          isNight: false
        };
        
        const testElement = document.createElement('div');
        await smartThemeAdapter.applyTheme(testTheme, [testElement]);
        
        resultDiv.innerHTML = `
          <div class="success">âœ… æ™ºèƒ½ä¸»é¢˜é€‚é…å™¨æµ‹è¯•é€šè¿‡</div>
          <div class="info">ä¸»é¢˜åº”ç”¨åŠŸèƒ½æ­£å¸¸</div>
        `;
        resultDiv.className = 'test-result success';
      } catch (error) {
        resultDiv.innerHTML = `<div class="error">âŒ æ™ºèƒ½ä¸»é¢˜é€‚é…å™¨æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
        resultDiv.className = 'test-result error';
      }
    }
    
    async function testThemeTransition() {
      const resultDiv = document.getElementById('theme-adapter-result');
      try {
        const stats = smartThemeAdapter.getStats();
        resultDiv.innerHTML += `
          <div class="info">ğŸ¨ ä¸»é¢˜é€‚é…å™¨ç»Ÿè®¡:</div>
          <pre>${JSON.stringify(stats, null, 2)}</pre>
        `;
      } catch (error) {
        resultDiv.innerHTML += `<div class="error">âŒ è·å–ä¸»é¢˜ç»Ÿè®¡å¤±è´¥: ${error.message}</div>`;
      }
    }
    
    // è¿è¡Œå®Œæ•´æµ‹è¯•
    async function runFullTest() {
      const resultDiv = document.getElementById('integration-result');
      resultDiv.innerHTML = '<div class="info">ğŸ”„ æ­£åœ¨è¿è¡Œå®Œæ•´æµ‹è¯•...</div>';
      
      let passedTests = 0;
      let totalTests = 5;
      
      try {
        // æµ‹è¯•æ‰€æœ‰æ¨¡å—
        await testErrorHandler();
        passedTests++;
        
        await testPerformanceMonitor();
        passedTests++;
        
        await testConfigManager();
        passedTests++;
        
        await testVideoResourceManager();
        passedTests++;
        
        await testThemeAdapter();
        passedTests++;
        
        resultDiv.innerHTML = `
          <div class="success">ğŸ‰ å®Œæ•´æµ‹è¯•å®Œæˆ</div>
          <div class="info">é€šè¿‡æµ‹è¯•: ${passedTests}/${totalTests}</div>
          <div class="info">æ‰€æœ‰ä¼˜åŒ–æ¨¡å—è¿è¡Œæ­£å¸¸</div>
        `;
        resultDiv.className = 'test-result success';
        
      } catch (error) {
        resultDiv.innerHTML = `
          <div class="error">âŒ å®Œæ•´æµ‹è¯•å¤±è´¥</div>
          <div class="error">é€šè¿‡æµ‹è¯•: ${passedTests}/${totalTests}</div>
          <div class="error">é”™è¯¯: ${error.message}</div>
        `;
        resultDiv.className = 'test-result error';
      }
    }
    
    // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', () => {
      initTestEnvironment();
      console.log('AeScape ä¼˜åŒ–åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
    });
  </script>
</body>
</html>
